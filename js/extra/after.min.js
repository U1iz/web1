var param={style:1,r:0.45,color:"rgba(255,255,255,0.8)",blurColor:"#ffcccc",arr1:[],arr2:[],rotation:0,offsetAngle:0,arr:[],waveArr:new Array(120),cX:0.5,cY:0.5,tX:50,tY:50,range:9,shadowBlur:15,lineWidth:9,showCircle:true,wavetransparency:0.8,timetransparency:0.8,sakuratransparency:0.8,showSemiCircle:false,SemiCircledirection:1};var can=document.querySelector("#can");var ctx=can.getContext("2d");var sakura=document.getElementById("sakura");var sakura_obj=sakura.getContext('experimental-webgl');function setCan(){ctx.strokeStyle=param.color;ctx.lineWidth=param.lineWidth;ctx.shadowBlur=param.shadowBlur;ctx.shadowColor=param.blurColor}var slideShow=modules.wallpaperEngineSlideShow({directoryPropertyName:"directory"});var slideShowDuration=10;var imageDurationTimeSpan=2;var slideShowFadeDuration=3;var backgroundSelect;var schemecolor;var image;var directory;function restartSlideshow(){if(backgroundSelect==3){switch(imageDurationTimeSpan){case 1:slideShow.restart(slideShowDuration*1000);break;case 2:slideShow.restart(slideShowDuration*1000*60);break;case 3:slideShow.restart(slideShowDuration*1000*60*60);break}}}window.wallpaperPropertyListener={applyUserProperties:function(properties){if(properties.backgroundSelect||properties.schemecolor||properties.image||properties.directory){if(properties.backgroundSelect){backgroundSelect=properties.backgroundSelect.value}if(properties.schemecolor){schemecolor=properties.schemecolor.value}if(properties.image){image=properties.image.value}if(properties.directory){directory=properties.directory.value}switch(backgroundSelect){case 1:$("body").css("transition","");slideShow.stop();var c=schemecolor.split(" ").map(function(c){return Math.ceil(c*255)});document.body.style.backgroundColor="rgb("+c+")";document.body.style.backgroundImage=null;break;case 2:$("body").css("transition","");slideShow.stop();document.body.style.backgroundSize="100% 100%";if(image){document.body.style.backgroundImage="url('file:///"+image+"')"}else{document.body.style.backgroundImage="url('1.jpg')"}break;case 3:restartSlideshow();break}}if(properties.slideShowDuration||properties.imageDurationTimeSpan){if(properties.slideShowDuration){slideShowDuration=properties.slideShowDuration.value}if(properties.imageDurationTimeSpan){imageDurationTimeSpan=properties.imageDurationTimeSpan.value}restartSlideshow()}if(properties.slideShowFadeDuration){slideShowFadeDuration=properties.slideShowFadeDuration.value;$("body").css("transition","background "+slideShowFadeDuration+"s linear")}if(properties.style){param.style=properties.style.value}if(properties.radius){param.r=properties.radius.value/100}if(properties.range){param.range=properties.range.value/5}if(properties.color){var c=properties.color.value.split(' ').map(function(c){return Math.ceil(c*255)});ctx.strokeStyle=param.color='rgba('+c+',0.8)';oClock.style.color='rgb('+c+')'}if(properties.blurColor){var c=properties.blurColor.value.split(' ').map(function(c){return Math.ceil(c*255)});ctx.shadowColor=param.blurColor='rgb('+c+')';oClock.style.textShadow='0 0 20px rgb('+c+')'}if(properties.showTime){oClock.style.display=properties.showTime.value?'block':'none'}if(properties.cX){param.cX=properties.cX.value*0.01}if(properties.cY){param.cY=properties.cY.value*0.01}if(properties.tX){param.tX=properties.tX.value;oClock.style.left=param.tX-50+'%'}if(properties.tY){param.tY=properties.tY.value;oClock.style.top=param.tY-50+'%'}if(properties.tSize){var s=properties.tSize.value;oClock.style.fontSize=Math.floor(h/300*s)+'px'}if(properties.tStyle){tStyle=properties.tStyle.value;getTime()}if(properties.rotation){param.rotation=properties.rotation.value}if(properties.lineWidth){ctx.lineWidth=param.lineWidth=properties.lineWidth.value}if(properties.showCircle){param.showCircle=properties.showCircle.value}if(properties.direction){param.direction=properties.direction.value}if(properties.sakuratransparency){param.sakuratransparency=properties.sakuratransparency.value/100;sakura_obj.canvas.style.opacity=param.sakuratransparency}if(properties.wavetransparency){param.wavetransparency=properties.wavetransparency.value/100;ctx.globalAlpha=param.wavetransparency}if(properties.timetransparency){param.timetransparency=properties.timetransparency.value/100;oClock.style.opacity=param.timetransparency}if(properties.showSemiCircle){param.showSemiCircle=properties.showSemiCircle.value}if(properties.SemiCircledirection){param.SemiCircledirection=properties.SemiCircledirection.value}}};function createPoint(arr){param.arr1=[];param.arr2=[];for(var i=0;i<120;i++){var deg;if(param.showSemiCircle){switch(param.SemiCircledirection){case 1:deg=Math.PI/120*(i+param.offsetAngle)*-1;break;case 2:deg=Math.PI/120*(i+param.offsetAngle);break}}else{deg=Math.PI/180*(i+param.offsetAngle)*3}var w1=arr[i]?arr[i]:0;var w2;if(param.waveArr[i]){w2=param.waveArr[i]-0.1}else{w2=0}w1=Math.max(w1,w2);param.waveArr[i]=w1=Math.min(w1,1.2);var w=w1*param.range*100;var offset1;var offset2;switch(param.direction){case 1:offset1=param.r*minW/2+w+1;offset2=param.r*minW/2;break;case 2:offset1=param.r*minW/2;offset2=param.r*minW/2-w-1;break;case 3:offset1=param.r*minW/2+w+1;offset2=param.r*minW/2-w-1;break}var p1=getXY(offset1,deg);var p2=getXY(offset2,deg);param.arr1.push({'x':p1.x,'y':p1.y});param.arr2.push({'x':p2.x,'y':p2.y})}if(param.rotation){param.offsetAngle+=param.rotation/20;if(param.offsetAngle>=360){param.offsetAngle=0}else if(param.offsetAngle<=0){param.offsetAngle=360}}}function getXY(offset,deg){return{'x':Math.cos(deg)*offset+param.cX*w,'y':Math.sin(deg)*offset+param.cY*h}}createPoint([]);function style1(){ctx.beginPath();for(var i=0;i<120;i++){ctx.moveTo(param.arr1[i].x,param.arr1[i].y);ctx.lineTo(param.arr2[i].x,param.arr2[i].y)}ctx.closePath();ctx.stroke()}function style2(){ctx.beginPath();ctx.moveTo(param.arr1[0].x,param.arr1[0].y);for(var i=0;i<120;i++){ctx.lineTo(param.arr1[i].x,param.arr1[i].y)}if(!param.showSemiCircle){ctx.closePath()}ctx.stroke();ctx.beginPath();if(param.showSemiCircle){ctx.moveTo(param.arr2[0].x,param.arr2[0].y);for(var i=0;i<120;i++){ctx.lineTo(param.arr2[i].x,param.arr2[i].y)}}else{ctx.moveTo(param.arr2[0].x,param.arr2[0].y);for(var i=0;i<120;i++){ctx.lineTo(param.arr2[i].x,param.arr2[i].y)}}if(!param.showSemiCircle){ctx.closePath()}ctx.stroke();ctx.beginPath();for(var i=0;i<120;i++){ctx.moveTo(param.arr1[i].x,param.arr1[i].y);ctx.lineTo(param.arr2[i].x,param.arr2[i].y)}ctx.closePath();ctx.stroke()}function style3(){ctx.beginPath();ctx.moveTo(param.arr1[0].x,param.arr1[0].y);for(var i=0;i<120;i++){ctx.lineTo(param.arr1[i].x,param.arr1[i].y)}if(!param.showSemiCircle){ctx.closePath()}ctx.stroke();ctx.beginPath();if(param.showSemiCircle){ctx.moveTo(param.arr2[0].x,param.arr2[0].y);for(var i=0;i<120;i++){ctx.lineTo(param.arr2[i].x,param.arr2[i].y)}}else{ctx.moveTo(param.arr2[0].x,param.arr2[0].y);for(var i=0;i<120;i++){ctx.lineTo(param.arr2[i].x,param.arr2[i].y)}}if(!param.showSemiCircle){ctx.closePath()}ctx.stroke()}style1();window.wallpaperRegisterAudioListener&&window.wallpaperRegisterAudioListener(wallpaperAudioListener);function wallpaperAudioListener(arr){ctx.clearRect(0,0,w,h);createPoint(arr);if(param.showCircle){switch(param.style){case 1:style1();break;case 2:style2();break;case 3:style3();break}}}